<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html"> <dom-module id="simpla-collection"> <template> <style>:host{display:block;position:relative}</style> <template is="dom-if" if="[[editable]]"> <simpla-collection-editor items="[[items]]" as="[[as]]" active="{{active}}" data-edit-button-visible$="[[_editButtonVisible]]" on-collection-item-edit="_handleEdit"> </simpla-collection-editor> </template> <slot></slot> </template> <script>!function(){"use strict";function t(){return Math.random().toString(36).substr(-5)}var i=function(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)},e="simpla-collection-editor.html",r={type:"Collection",dataProperties:["items"]};Polymer({is:"simpla-collection",properties:{items:{type:Array,value:[]},as:{type:String,value:"item"},active:{type:Boolean,notify:!0,value:!1},editable:{type:Boolean,observer:"_importEditor",notify:!0,value:!1},_editButtonVisible:Boolean},listeners:{mouseover:"_showEditButton",mouseout:"_hideEditButton"},observers:["_render(items.*)"],behaviors:[SimplaBehaviors.Element(r)],add:function(){this.push("items",{id:t()})},remove:function(t){var i=this.items,e=this.path+"/"+t,r=i.find(function(i){return i.id===t}),o=i.indexOf(r);Simpla.remove(e),this.splice("items",o,1)},swap:function(t,i){var e=this,r=function(t){return e.items.find(function(i){return i.id===t})},o=this.items,n=o.slice(),s=o.indexOf(r(t)),a=o.indexOf(r(i));n[a]=o[s],n[s]=o[a],this.items=n},_render:function(){for(var t=this,i=Polymer.dom(this).querySelector("template"),e=this.items,r=function(i,e){var r=["path","sid","gid"];r.forEach(function(r){Array.prototype.forEach.call(i.querySelectorAll("["+r+"]"),function(i){var o=i.getAttribute(r);i.setAttribute(r,o.replace("["+t.as+"]",e))})})};this.children.length>1;)Polymer.dom(this).removeChild(this.children[1]);e.forEach(function(e,o){var n=document.importNode(i.content,!0);r(n,e.id),Polymer.dom(t).appendChild(n)})},_handleEdit:function(t){var e=t.detail.action,r=t.detail.args;t.stopPropagation(),this[e].apply(this,i(r))},_importEditor:function(t){t&&this.importHref(this.resolveUrl(e))},_showEditButton:function(){this._editButtonVisible=!0},_hideEditButton:function(){this._editButtonVisible=!1}})}(); </script> </dom-module> 