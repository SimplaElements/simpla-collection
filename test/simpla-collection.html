<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>simpla-collection</title>

    <!-- Import WCT-->
    <script src="https://unpkg.com/webcomponents.js/@^0.7.24/webcomponents-lite.min.js"></script>
    <link rel="import" href="../../test-fixture/test-fixture.html">
    <script src="../../web-component-tester/browser.js"></script>

    <!-- Import Simpla -->
    <script src="https://unpkg.com/simpla@^2.0.0"></script>

    <!-- Import the element to test -->
    <link rel="import" href="../simpla-collection.html">

  </head>
  <body>
    <script>
      Simpla.init('dummy');
    </script>

    <test-fixture id="default">
      <template>
        <simpla-collection path="/test">
          <template>
            <div path="/test/[item]"></div>
          </template>
        </simpla-collection>
      </template>
    </test-fixture>
    <script>
      const COLLECTION_PATH = '/test',
            EDITOR_COMPONENT = 'simpla-collection-editor.html',
            ITEMS = () => [
              { id: 'first' },
              { id: 'second' },
            ];

      describe('<simpla-collection>', function() {
        var component;

        beforeEach(function() {
          component = fixture('default');
          Simpla = window.Simpla;
        });

        it('is okay', function() {
          expect(component).to.be.ok;
        });

        describe('rendering', function() {

          it('renders the template for all items in the collection', function() {
            // @TODO
          });

          it('properly updates rendered DOM when an item is added', function() {
            component.items = ITEMS();
            // @TODO expect
            component.items = ITEMS().push({ id: 'third' });
            // @TODO expect
          });

          it('properly updates rendered DOM when an item is removed', function() {
            component.items = ITEMS();
            // @TODO expect
            component.items = ITEMS().slice(1,1);
          });

          it('property updates rendered DOM when two items are swapped', function() {
            // @TODO
          })

        });

        describe('templating', function() {

          it('replaces the [item] key in paths with the item id', function() {
            // @TODO
          });

          it('replaces the [item] key in SIDs and GIDs with the item id', function() {
            // @TODO
          });

          it('replaces the item key in paths when a custom item name is set', function() {
            // @TODO
          });

        })

        describe('editor', function() {

          it('imports the editor component when editable is true', function() {
            Simpla.editable(true);
            expect(document.head.querySelector('link[href$="' + EDITOR_COMPONENT + '"]')).to.be.ok;
          });

        });

        describe('manipulations', function() {

          it('adds an item to the collection when add() is called', function() {
            expect(component.items.length).to.equal(0);
            component.add();
            expect(component.items.length).to.equal(1);
            expect(component.items[0].id).to.be.ok;
          });

          it('removes the correct item from the collection when remove(id) is called', function() {
            component.items = ITEMS();
            component.remove(ITEMS()[0].id);
            expect(component.items[0].id).to.not.equal(ITEMS()[0].id);
          });

          it('removes all Simpla data for an item when remove(id) is called', function() {
            Simpla.set(COLLECTION_PATH, {
              type: 'Collection',
              data: {
                items: ITEMS()
              }
            });
            component.remove(ITEMS()[0].id);
            expect(Simpla.get(COLLECTION_PATH + '/' + ITEMS()[0].id)).to.be.empty;
          });

          it('swaps the correct items in the collection when swap(a, b) is called', function() {
            component.items = ITEMS();
            component.swap(ITEMS()[0].id, ITEMS()[1].id);
            expect(component.items[0].id).to.equal(ITEMS()[1].id);
            expect(component.items[1].id).to.equal(ITEMS()[0].id);
          });
        })
      });
    </script>
  </body>
</html>
